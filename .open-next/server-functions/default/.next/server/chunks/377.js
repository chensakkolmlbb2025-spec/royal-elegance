"use strict";exports.id=377,exports.ids=[377],exports.modules={7629:(a,b,c)=>{c.d(b,{p:()=>f});var d=c(21124);c(38301);var e=c(15514);function f({className:a,type:b,...c}){return(0,d.jsx)("input",{type:b,"data-slot":"input",className:(0,e.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...c})}},50377:(a,b,c)=>{c.d(b,{s:()=>o});var d=c(21124),e=c(38301),f=c(42378),g=c(10643),h=c(45119),i=c(19217),j=c(7629),k=c(53199),l=c(8044),m=c(75934),n=c(62037);function o({user:a,roomType:b,room:c,services:o,onCancel:p}){(0,f.useRouter)();let{toast:q}=(0,n.dj)(),r=(0,g.U)(),[s,t]=(0,e.useState)(""),[u,v]=(0,e.useState)(""),[w,x]=(0,e.useState)(1),[y,z]=(0,e.useState)([]),[A,B]=(0,e.useState)(!1),[C,D]=(0,e.useState)(null),E=()=>{if(!s||!u)return 0;let a=new Date(s),b=Math.ceil((new Date(u).getTime()-a.getTime())/864e5);return b>0?b:0},F=()=>{let a=E();return b.basePrice*a+y.reduce((a,b)=>{let c=o.find(a=>a.id===b);return a+(c?.price||0)},0)},G=a=>Array.isArray(a)?a.map(G):null!==a&&"object"==typeof a?Object.keys(a).reduce((b,c)=>(b[c.replace(/[A-Z]/g,a=>`_${a.toLowerCase()}`)]=G(a[c]),b),{}):a,H=a=>new Date(a).toISOString().split("T")[0],I=async d=>{d.preventDefault();try{let d={userId:a.id,guestName:a?.user_metadata?.full_name||a.email?.split("@")[0]||"Guest",guestEmail:a.email||"",guestPhone:a?.user_metadata?.phone||"Not provided",guestCount:w,roomId:c.id,roomTypeId:b.id,checkInDate:H(s),checkOutDate:H(u),roomPrice:b.basePrice*E(),servicesPrice:y.reduce((a,b)=>{let c=o.find(a=>a.id===b);return a+(c?.price||0)},0),totalPrice:F(),status:"confirmed",paymentStatus:"pending",paymentMethod:"credit_card",paidAmount:0,bookingReference:`BK-${Date.now()}-${Math.random().toString(36).substring(2,9).toUpperCase()}`},e=G(d);console.log("[Booking] Creating booking with data:",{userId:e.user_id,roomId:e.room_id,checkIn:e.check_in_date,checkOut:e.check_out_date,total:e.total_price,status:e.status,paymentStatus:e.payment_status});let{data:f,error:g}=await r.from("bookings").insert([e]).select().single();if(g||!f)throw console.error("[Booking] Failed to create booking:",g),Error(g?.message||"Failed to create booking");let h=f.id;if(console.log("[Booking] Successfully created booking with ID:",h),D(h),y.length>0){let a=y.map(a=>{let b=o.find(b=>b.id===a);return{booking_id:h,service_id:a,quantity:1,unit_price:b?.price||0,total_price:b?.price||0,status:"confirmed"}}),{error:b}=await r.from("booking_services").insert(a);b&&console.error("Error adding services:",b)}B(!0)}catch(a){console.error("[Booking] Failed to create booking:",a),q({title:"Booking failed",description:a.message||"Could not start payment.",variant:"destructive"})}};return A&&C?(0,d.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,d.jsxs)("div",{className:"lg:col-span-2",children:[(0,d.jsx)(m.z,{bookingId:C,amount:Math.round(100*F()),currency:"usd",customerEmail:a.email||void 0}),(0,d.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,d.jsx)(i.$,{variant:"outline",onClick:()=>B(!1),children:"Back"}),p&&(0,d.jsx)(i.$,{variant:"outline",onClick:p,children:"Cancel Booking"})]})]}),(0,d.jsx)("div",{children:(0,d.jsxs)(h.Zp,{className:"glass-card sticky top-24",children:[(0,d.jsx)(h.aR,{children:(0,d.jsx)(h.ZB,{children:"Payment Summary"})}),(0,d.jsxs)(h.Wu,{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-semibold text-lg",children:b.name}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Room ",c.roomNumber]})]}),(0,d.jsx)(l.w,{}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,d.jsx)("span",{children:"Total Amount"}),(0,d.jsxs)("span",{className:"price-badge",children:["$",F()]})]})]})]})})]}):(0,d.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,d.jsx)("div",{className:"lg:col-span-2",children:(0,d.jsxs)(h.Zp,{className:"glass-card border-0",children:[(0,d.jsxs)(h.aR,{children:[(0,d.jsx)(h.ZB,{children:"Complete Your Booking"}),(0,d.jsx)(h.BT,{children:"Fill in the details below to reserve your room"})]}),(0,d.jsx)(h.Wu,{children:(0,d.jsxs)("form",{onSubmit:I,className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(k.J,{htmlFor:"checkIn",children:"Check-in Date"}),(0,d.jsx)(j.p,{id:"checkIn",type:"date",value:s,onChange:a=>t(a.target.value),min:new Date().toISOString().split("T")[0],required:!0})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(k.J,{htmlFor:"checkOut",children:"Check-out Date"}),(0,d.jsx)(j.p,{id:"checkOut",type:"date",value:u,onChange:a=>v(a.target.value),min:s||new Date().toISOString().split("T")[0],required:!0})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(k.J,{htmlFor:"guests",children:"Number of Guests"}),(0,d.jsx)(j.p,{id:"guests",type:"number",value:w,onChange:a=>x(Number.parseInt(a.target.value)),min:1,max:b.maxOccupancy,required:!0}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Maximum ",b.maxOccupancy," guests"]})]}),o.length>0&&(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(k.J,{children:"Additional Services (Optional)"}),(0,d.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:o.map(a=>(0,d.jsx)("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${y.includes(a.id)?"border-primary bg-primary/5":"border-muted hover:border-primary/50"}`,onClick:()=>{var b;return b=a.id,void z(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${y.includes(a.id)?"bg-primary border-primary":"border-muted"}`,children:y.includes(a.id)&&(0,d.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("p",{className:"text-sm font-medium",children:a.name}),(0,d.jsxs)("p",{className:"text-xs text-muted-foreground",children:["$",a.price]})]})]})},a.id))})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(i.$,{type:"submit",className:"flex-1 glass-button",size:"lg",children:"Continue to Payment"}),p&&(0,d.jsx)(i.$,{type:"button",variant:"outline",onClick:p,children:"Cancel"})]})]})})]})}),(0,d.jsx)("div",{children:(0,d.jsxs)(h.Zp,{className:"glass-card sticky top-24",children:[(0,d.jsx)(h.aR,{children:(0,d.jsx)(h.ZB,{children:"Booking Summary"})}),(0,d.jsxs)(h.Wu,{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"font-semibold text-lg",children:b.name}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Room ",c.roomNumber]})]}),(0,d.jsx)(l.w,{}),s&&u&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Check-in"}),(0,d.jsx)("span",{className:"font-medium",children:new Date(s).toLocaleDateString()})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Check-out"}),(0,d.jsx)("span",{className:"font-medium",children:new Date(u).toLocaleDateString()})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Nights"}),(0,d.jsx)("span",{className:"font-medium",children:E()})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:"Guests"}),(0,d.jsx)("span",{className:"font-medium",children:w})]})]}),(0,d.jsx)(l.w,{}),(0,d.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsxs)("span",{className:"text-muted-foreground",children:["Room (",E()," nights)"]}),(0,d.jsxs)("span",{className:"font-medium",children:["$",b.basePrice*E()]})]}),y.map(a=>{let b=o.find(b=>b.id===a);return(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-muted-foreground",children:b?.name}),(0,d.jsxs)("span",{className:"font-medium",children:["$",b?.price]})]},a)})]}),(0,d.jsx)(l.w,{}),(0,d.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,d.jsx)("span",{children:"Total"}),(0,d.jsxs)("span",{className:"price-badge",children:["$",F()]})]})]})]})]})})]})}},53199:(a,b,c)=>{c.d(b,{J:()=>j});var d=c(21124),e=c(38301),f=c(71538),g=c(26691),h=c(15514);let i=(0,g.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.b,{ref:c,className:(0,h.cn)(i(),a),...b}));j.displayName=f.b.displayName}};