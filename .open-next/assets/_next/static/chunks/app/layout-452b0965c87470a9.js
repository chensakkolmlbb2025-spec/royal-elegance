(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{3740:(e,r,t)=>{"use strict";t.d(r,{AuthProvider:()=>T});var s=t(95155),a=t(12115),o=t(57878);let n=async e=>{if(!o.N)return null;try{let{data:r,error:t}=await o.N.from("profiles").select("*").eq("id",e.id).single();if(t){let e=null==t?void 0:t.code,r=(null==t?void 0:t.message)||"",s=(null==t?void 0:t.details)||"";if("42P01"===e||r.includes("relation")||r.includes("does not exist"))return console.warn("⚠️ Profiles table not found. Please run the database schema from supabase-auth-schema.sql"),console.warn("\uD83D\uDCDA See AUTHENTICATION_SETUP.md for setup instructions"),null;if("PGRST116"===e||/RLS|row level|Policies|permission/i.test(r)||/RLS|Policies|permission/i.test(s))return console.warn('Profile query blocked by RLS. Ensure a policy allows users to read their own profile. See supabase-auth-fix.sql or apply policy: CREATE POLICY "Users can view own profile" ON public.profiles FOR SELECT USING ((SELECT auth.uid())::uuid = id);',{code:e,message:r}),null;return console.error("Error fetching profile:",{code:e,message:r,details:s}),null}if(!r)return console.warn("Profile not found for user. Ensure signup trigger created a profile row (see supabase-auth-schema.sql) or insert policy allows creation.",{userId:e.id}),null;return{id:e.id,email:e.email||"",fullName:r.full_name,phone:r.phone,role:r.role,avatarUrl:r.avatar_url,emailVerified:r.email_verified||!1,phoneVerified:r.phone_verified||!1,mfaEnabled:r.mfa_enabled||!1,accountLocked:r.account_locked||!1,lastLoginAt:r.last_login_at?new Date(r.last_login_at):null,createdAt:new Date(r.created_at)}}catch(e){return console.error("Error converting user:",e),null}},i=async(e,r,t)=>{if(o.N)try{await o.N.from("login_attempts").insert([{email:e,success:r,ip_address:t,attempted_at:new Date().toISOString()}])}catch(e){console.error("Error logging login attempt:",e)}},l=async e=>{if(!o.N)return!1;try{let{data:r,error:t}=await o.N.from("profiles").select("account_locked, failed_login_attempts").eq("email",e).single();if(t||!r)return!1;return r.account_locked||!1}catch(e){return console.error("Error checking account lock:",e),!1}},u=async e=>{if(o.N)try{await o.N.rpc("increment_failed_login",{user_email:e})}catch(e){console.error("Error incrementing failed login:",e)}},c=async e=>{if(o.N)try{await o.N.rpc("reset_failed_login",{user_email:e})}catch(e){console.error("Error resetting failed login:",e)}},d=async(e,r)=>{if(o.N)try{await o.N.from("user_sessions").insert([{user_id:e,device_info:r||navigator.userAgent,user_agent:navigator.userAgent,last_activity:new Date().toISOString()}])}catch(e){console.error("Error creating session record:",e)}},f=async e=>{if(!o.N)return{user:null,session:null,error:{message:"Supabase not initialized"}};try{let{data:r,error:t}=await o.N.auth.signUp({email:e.email,password:e.password,options:{data:{full_name:e.fullName,phone:e.phone},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(t)return{user:null,session:null,error:t};if(!r.user)return{user:null,session:null,error:{message:"User creation failed"}};return{user:await n(r.user),session:r.session,error:null}}catch(e){return console.error("Sign up error:",e),{user:null,session:null,error:e}}},h=async e=>{if(!o.N)return{user:null,session:null,error:{message:"Supabase not initialized"}};try{if(await l(e.email))return{user:null,session:null,error:{message:"Account is locked due to multiple failed login attempts. Please contact support."}};let{data:r,error:t}=await o.N.auth.signInWithPassword({email:e.email,password:e.password});if(await i(e.email,!t),t)return await u(e.email),{user:null,session:null,error:t};if(!r.user)return{user:null,session:null,error:{message:"Sign in failed"}};return await c(e.email),await d(r.user.id),{user:await n(r.user),session:r.session,error:null}}catch(e){return console.error("Sign in error:",e),{user:null,session:null,error:e}}},m=async()=>{if(!o.N)return console.error("Google OAuth: Supabase not initialized"),{error:{message:"Supabase not initialized"}};try{console.log("Google OAuth: Starting sign in..."),console.log("Google OAuth: Redirect URL:","".concat(window.location.origin,"/auth/callback"));let{data:s,error:a}=await o.N.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback"),queryParams:{access_type:"offline",prompt:"consent"}}});if(console.log("Google OAuth: Response data:",s),console.log("Google OAuth: Response error:",a),a){var e,r,t;console.error("Google OAuth: Authentication error:",a),(null==(e=a.message)?void 0:e.includes("Google"))&&console.error("Google OAuth: This might be a Google provider configuration issue in Supabase dashboard"),(null==(r=a.message)?void 0:r.includes("redirect"))&&console.error("Google OAuth: This might be a redirect URL mismatch issue"),(null==(t=a.message)?void 0:t.includes("client"))&&console.error("Google OAuth: This might be a Google Client ID/Secret configuration issue")}return{error:a}}catch(e){return console.error("Google OAuth: Exception occurred:",e),{error:e}}},p=async e=>{if(!o.N)return{error:{message:"Supabase not initialized"}};try{let{error:r}=await o.N.auth.signInWithOtp({phone:e});return{error:r}}catch(e){return console.error("Phone sign in error:",e),{error:e}}},g=async(e,r)=>{if(!o.N)return{user:null,session:null,error:{message:"Supabase not initialized"}};try{let{data:t,error:s}=await o.N.auth.verifyOtp({phone:e,token:r,type:"sms"});if(s||!t.user)return{user:null,session:null,error:s};return await o.N.from("profiles").update({phone_verified:!0}).eq("id",t.user.id),{user:await n(t.user),session:t.session,error:null}}catch(e){return console.error("Phone OTP verification error:",e),{user:null,session:null,error:e}}},w=async()=>{if(!o.N)return{error:{message:"Supabase not initialized"}};try{let{error:e}=await o.N.auth.signOut();return{error:e}}catch(e){return console.error("Sign out error:",e),{error:e}}},v=async e=>{if(!o.N)return{error:{message:"Supabase not initialized"}};try{let{error:r}=await o.N.auth.resetPasswordForEmail(e.email,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});return{error:r}}catch(e){return console.error("Password reset request error:",e),{error:e}}},N=async e=>{if(!o.N)return{error:{message:"Supabase not initialized"}};try{var r;let{data:t}=await o.N.auth.getUser();if(!(null==(r=t.user)?void 0:r.email))return{error:{message:"User not found"}};let{error:s}=await o.N.auth.signInWithPassword({email:t.user.email,password:e.currentPassword});if(s)return{error:{message:"Current password is incorrect"}};let{error:a}=await o.N.auth.updateUser({password:e.newPassword});return{error:a}}catch(e){return console.error("Password update error:",e),{error:e}}},y=async e=>{if(!o.N)return{error:Error("Supabase not initialized")};try{let{data:r}=await o.N.auth.getUser();if(!r.user)return{error:Error("User not found")};let t={};void 0!==e.fullName&&(t.full_name=e.fullName),void 0!==e.phone&&(t.phone=e.phone),void 0!==e.avatarUrl&&(t.avatar_url=e.avatarUrl);let{error:s}=await o.N.from("profiles").update(t).eq("id",r.user.id);return{error:s}}catch(e){return console.error("Profile update error:",e),{error:e}}},b=async()=>{if(!o.N)return null;try{let{data:{user:e}}=await o.N.auth.getUser();if(!e)return null;return await n(e)}catch(e){return console.error("Get current user error:",e),null}},S=async()=>{if(!o.N)return{error:{message:"Supabase not initialized"}};try{var e;let{data:r}=await o.N.auth.getUser();if(!(null==(e=r.user)?void 0:e.email))return{error:{message:"User not found"}};let{error:t}=await o.N.auth.resend({type:"signup",email:r.user.email,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});return{error:t}}catch(e){return console.error("Resend email verification error:",e),{error:e}}};async function x(){try{o.N&&await o.N.auth.signOut();let e=[];for(let r=0;r<localStorage.length;r++){let t=localStorage.key(r);t&&(t.startsWith("supabase.")||t.startsWith("sb-")||t.includes("auth-token")||t.includes("refresh-token"))&&e.push(t)}e.forEach(e=>localStorage.removeItem(e));let r=[];for(let e=0;e<sessionStorage.length;e++){let t=sessionStorage.key(e);t&&(t.startsWith("supabase.")||t.startsWith("sb-")||t.includes("auth-token")||t.includes("refresh-token"))&&r.push(t)}r.forEach(e=>sessionStorage.removeItem(e)),console.log("\uD83E\uDDF9 Auth storage cleared")}catch(e){console.error("Error clearing auth storage:",e)}}async function _(e){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],t=(null==e?void 0:e.message)||"";if((t.includes("refresh")||t.includes("Refresh Token Not Found")||t.includes("Invalid Refresh Token")||t.includes("token")||t.includes("session")||t.includes("Invalid")||(null==e?void 0:e.status)===401)&&(console.warn("\uD83D\uDD12 Auth error detected, clearing session:",t),await x(),r&&1)){let e=window.location.pathname;"/login"===e||"/auth/signup"===e||"/auth/callback"===e||e.startsWith("/auth/")||(sessionStorage.setItem("redirectAfterLogin",e),setTimeout(()=>{window.location.href="/login"},100))}}let E=(0,a.createContext)(void 0);function T(e){let{children:r}=e,[t,n]=(0,a.useState)(null),[i,l]=(0,a.useState)(null),[u,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if((async()=>{try{if(!o.N)return void c(!1);let{data:{session:s},error:a}=await o.N.auth.getSession();if(a){var e,r,t;if((null==(e=a.message)?void 0:e.includes("refresh"))||(null==(r=a.message)?void 0:r.includes("Refresh Token Not Found"))||(null==(t=a.message)?void 0:t.includes("Invalid Refresh Token"))){console.warn("Invalid refresh token detected, clearing session silently"),await x(),l(null),n(null),c(!1);return}console.warn("Session error:",a.message),await x(),l(null),n(null),c(!1);return}if(!s){l(null),n(null),c(!1);return}if(l(s),null==s?void 0:s.user){let e=await b();n(e)}}catch(e){console.error("Error initializing auth:",e),await x(),l(null),n(null)}finally{c(!1)}})(),o.N){let{data:{subscription:e}}=o.N.auth.onAuthStateChange(async(e,r)=>{var t;if(console.log("=== AUTH STATE CHANGE ==="),console.log("Event:",e),console.log("Session:",r?"present":"null"),console.log("User:",(null==r||null==(t=r.user)?void 0:t.email)||"none"),"TOKEN_REFRESHED"===e&&!r){console.warn("Token refresh failed, clearing session silently"),await x(),l(null),n(null);return}if("SIGNED_OUT"===e){console.log("User signed out, clearing session"),await x(),l(null),n(null);return}l(r),(null==r?void 0:r.user)?n(await b()):n(null),console.log("=== AUTH STATE CHANGE COMPLETE ===")});return()=>{e.unsubscribe()}}},[]);let d=async e=>{try{let{user:r,session:t,error:s}=await h(e);if(s)throw await _(s,!1),s;n(r),l(t)}catch(e){throw await _(e,!1),e}},T=async e=>{try{let{user:r,session:t,error:s}=await f(e);if(s)throw await _(s,!1),s;n(r),l(t)}catch(e){throw await _(e,!1),e}},A=async()=>{try{let{error:e}=await w();if(e)throw e;await x(),n(null),l(null)}catch(e){console.error("Sign out error:",e),await x(),n(null),l(null)}},I=async()=>{let{error:e}=await m();if(e)throw e},O=async e=>{let{error:r}=await p(e);if(r)throw r},P=async(e,r)=>{let{user:t,session:s,error:a}=await g(e,r);if(a)throw a;n(t),l(s)},k=async e=>{let{error:r}=await v({email:e});if(r)throw r},U=async(e,r)=>{let{error:t}=await N({currentPassword:e,newPassword:r});if(t)throw t},j=async e=>{let{error:r}=await y(e);if(r)throw r;n(await b())},R=async()=>{let{error:e}=await S();if(e)throw e};return(0,s.jsx)(E.Provider,{value:{user:t,session:i,loading:u,signIn:d,signUp:T,signOut:A,signInWithGoogle:I,signInWithPhone:O,verifyPhoneOtp:P,requestPasswordReset:k,updatePassword:U,updateProfile:j,resendEmailVerification:R},children:r})}},9216:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,41290,23)),Promise.resolve().then(t.bind(t,48036)),Promise.resolve().then(t.bind(t,97687)),Promise.resolve().then(t.bind(t,3740)),Promise.resolve().then(t.bind(t,68955)),Promise.resolve().then(t.t.bind(t,19307,23)),Promise.resolve().then(t.t.bind(t,96704,23))},25016:(e,r,t)=>{"use strict";t.d(r,{cn:()=>o});var s=t(2821),a=t(75889);function o(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}},28171:(e,r,t)=>{"use strict";t.d(r,{dj:()=>d});var s=t(12115);let a=0,o=new Map,n=e=>{if(o.has(e))return;let r=setTimeout(()=>{o.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,r)},i=[],l={toasts:[]};function u(e){l=((e,r)=>{switch(r.type){case"ADD_TOAST":return{...e,toasts:[r.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===r.toast.id?{...e,...r.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=r;return t?n(t):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===r.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==r.toastId)}}})(l,e),i.forEach(e=>{e(l)})}function c(e){let{...r}=e,t=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>u({type:"DISMISS_TOAST",toastId:t});return u({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function d(){let[e,r]=s.useState(l);return s.useEffect(()=>(i.push(r),()=>{let e=i.indexOf(r);e>-1&&i.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},41290:()=>{},48036:(e,r,t)=>{"use strict";t.d(r,{EnvBanner:()=>i});var s=t(95155),a=t(57878),o=t(52619),n=t.n(o);function i(){return(0,a.h)()?null:(0,s.jsx)("div",{className:"w-full bg-amber-100 text-amber-900 border-b border-amber-200",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-2 text-sm flex flex-col md:flex-row items-start md:items-center gap-2 md:gap-4",children:[(0,s.jsx)("span",{className:"font-medium",children:"Supabase is not configured."}),(0,s.jsxs)("span",{children:["Set ",(0,s.jsx)("code",{className:"font-mono",children:"NEXT_PUBLIC_SUPABASE_URL"})," and ",(0,s.jsx)("code",{className:"font-mono",children:"NEXT_PUBLIC_SUPABASE_ANON_KEY"})," in ",(0,s.jsx)("code",{className:"font-mono",children:".env.local"}),"."]}),(0,s.jsxs)("span",{className:"ml-auto",children:[(0,s.jsx)(n(),{href:"/",onClick:e=>e.stopPropagation(),className:"underline hover:no-underline",children:"View setup guide"}),(0,s.jsx)("span",{className:"mx-1",children:"\xb7"}),(0,s.jsx)("a",{href:"https://supabase.com/dashboard",target:"_blank",rel:"noreferrer",className:"underline hover:no-underline",children:"Open Supabase Dashboard"})]})]})})}},57878:(e,r,t)=>{"use strict";let s;t.d(r,{N:()=>s,h:()=>i});var a=t(85553);let o="https://jxtgigcmplvjmtsxpfrp.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4dGdpZ2NtcGx2am10c3hwZnJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjE5OTksImV4cCI6MjA3NzY5Nzk5OX0.knIYsJJNWRo3UYvUlXgNmvWYZDQ1sacCWPBSMyFY_BM";function i(){return!!o&&!!n||(console.error("[Supabase] Missing configuration. Please check your environment variables."),console.error("[Supabase] Required: NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY"),!1)}try{i()&&o&&n?(s=(0,a.UU)(o,n,{auth:{flowType:"pkce",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),console.log("[Supabase] Client initialized successfully")):console.error("[Supabase] Configuration validation failed. Please check your environment variables.")}catch(e){console.error("[Supabase] Initialization error:",e)}},97687:(e,r,t)=>{"use strict";t.d(r,{Toaster:()=>w});var s=t(95155),a=t(28171),o=t(12115),n=t(39582),i=t(83101),l=t(65229),u=t(25016);let c=n.Kq,d=o.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.LM,{ref:r,className:(0,u.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...a})});d.displayName=n.LM.displayName;let f=(0,i.F)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),h=o.forwardRef((e,r)=>{let{className:t,variant:a,...o}=e;return(0,s.jsx)(n.bL,{ref:r,className:(0,u.cn)(f({variant:a}),t),...o})});h.displayName=n.bL.displayName,o.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.rc,{ref:r,className:(0,u.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...a})}).displayName=n.rc.displayName;let m=o.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.bm,{ref:r,className:(0,u.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...a,children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})});m.displayName=n.bm.displayName;let p=o.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.hE,{ref:r,className:(0,u.cn)("text-sm font-semibold",t),...a})});p.displayName=n.hE.displayName;let g=o.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(n.VY,{ref:r,className:(0,u.cn)("text-sm opacity-90",t),...a})});function w(){let{toasts:e}=(0,a.dj)();return(0,s.jsxs)(c,{children:[e.map(function(e){let{id:r,title:t,description:a,action:o,...n}=e;return(0,s.jsxs)(h,{...n,children:[(0,s.jsxs)("div",{className:"grid gap-1",children:[t&&(0,s.jsx)(p,{children:t}),a&&(0,s.jsx)(g,{children:a})]}),o,(0,s.jsx)(m,{})]},r)}),(0,s.jsx)(d,{})]})}g.displayName=n.VY.displayName}},e=>{e.O(0,[1741,6192,4174,9015,6741,8441,1255,7358],()=>e(e.s=9216)),_N_E=e.O()}]);