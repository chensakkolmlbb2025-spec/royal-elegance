(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2991],{6221:(e,t,a)=>{Promise.resolve().then(a.bind(a,43863))},16485:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},20508:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},43863:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var s=a(95155),r=a(12115),n=a(20063),i=a(8525),l=a(4939),o=a(34456),d=a(59001),c=a(65524),u=a(31081),h=a(36654),g=a(90923),m=a(16485),f=a(91169),p=a(19408);function v(){let[e,t]=(0,r.useState)(null),[a,v]=(0,r.useState)(null),[x,y]=(0,r.useState)(!0),k=(0,n.useRouter)(),_=(0,i.U)(),[b,j]=(0,r.useState)([]),[w,N]=(0,r.useState)([]);if((0,r.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await _.auth.getUser();if(!e)return void k.push("/");t(e);let{data:a}=await _.from("profiles").select("role").eq("id",e.id).single();if(!a||"staff"!==a.role)return void k.push("/");v(a)}catch(e){console.error("Error loading user:",e),k.push("/")}finally{y(!1)}})();let{data:{subscription:e}}=_.auth.onAuthStateChange((e,t)=>{(null==t?void 0:t.user)||k.push("/")});return()=>e.unsubscribe()},[_,k]),(0,r.useEffect)(()=>{(null==a?void 0:a.role)==="staff"&&(async()=>{try{let{data:e,error:t}=await _.from("bookings").select("*").order("created_at",{ascending:!1});if(t)throw t;let a=e.map(e=>({...e,id:e.id,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),checkInDate:new Date(e.check_in_date),checkOutDate:new Date(e.check_out_date),checkIn:new Date(e.check_in_date),checkOut:new Date(e.check_out_date),floorId:e.floor_id,roomTypeId:e.room_type_id,roomId:e.room_id,userId:e.user_id,guestName:e.guest_name,guestEmail:e.guest_email,guestPhone:e.guest_phone,guestCount:e.guest_count,guests:e.guest_count,bookingReference:e.booking_reference,paymentMethod:e.payment_method,paidAmount:e.paid_amount,paymentStatus:e.payment_status,bookingType:e.room_id?"room":"service",totalPrice:e.total_price,status:e.status,services:e.services||[]})),s=await (0,l.t8)();j(a),N(s),console.log("Staff loaded bookings:",a.length)}catch(e){console.error("Error fetching staff data:",e)}})()},[a,_]),x)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-accent/5 to-background",children:(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-[#d4af37] border-t-transparent rounded-full animate-spin"})});if(!e||!a||"staff"!==a.role)return null;let D=b.filter(e=>{let t=new Date,a=new Date(e.checkIn);return a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()}).length,A=b.filter(e=>"pending"===e.status).length,C=w.filter(e=>"occupied"===e.status).length;return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-background via-accent/5 to-background",children:[(0,s.jsx)(o.z,{}),(0,s.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)(g.tU,{defaultValue:"dashboard",className:"space-y-6",children:[(0,s.jsxs)(g.j7,{className:"glass-card border-0 animate-fade-in",children:[(0,s.jsx)(g.Xi,{value:"dashboard",children:"Dashboard"}),(0,s.jsx)(g.Xi,{value:"bookings",children:"Bookings"}),(0,s.jsx)(g.Xi,{value:"calendar",children:"Calendar"})]}),(0,s.jsxs)(g.av,{value:"dashboard",className:"space-y-6",children:[(0,s.jsxs)("div",{className:"glass-banner border-0 p-6 rounded-lg animate-fade-in-up",children:[(0,s.jsx)("h2",{className:"text-4xl font-display font-bold mb-2 text-slate-900",children:"Staff Dashboard"}),(0,s.jsx)("p",{className:"text-muted-foreground text-lg",children:"Manage daily operations and guest services"})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,s.jsx)("div",{style:{animationDelay:"0s"},children:(0,s.jsx)(d.C,{title:"Today's Check-ins",value:D,description:"Guests arriving today",icon:m.A})}),(0,s.jsx)("div",{style:{animationDelay:"0.1s"},children:(0,s.jsx)(d.C,{title:"Pending Bookings",value:A,description:"Awaiting confirmation",icon:f.A})}),(0,s.jsx)("div",{style:{animationDelay:"0.2s"},children:(0,s.jsx)(d.C,{title:"Occupied Rooms",value:C,description:"Out of ".concat(w.length," total"),icon:p.A})})]}),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsx)(c.C,{limit:10})}),(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsx)(u.z,{})})]})]}),(0,s.jsx)(g.av,{value:"bookings",children:(0,s.jsx)(c.C,{})}),(0,s.jsx)(g.av,{value:"calendar",children:(0,s.jsx)(h._,{})})]})})]})}}},e=>{e.O(0,[4174,6010,112,3148,5058,2039,6494,2649,916,8441,1255,7358],()=>e(e.s=6221)),_N_E=e.O()}]);