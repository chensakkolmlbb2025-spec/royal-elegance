"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7169],{33789:(e,s,t)=>{t.d(s,{p:()=>a});var i=t(95155);t(12115);var r=t(25016);function a(e){let{className:s,type:t,...a}=e;return(0,i.jsx)("input",{type:t,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...a})}},47169:(e,s,t)=>{t.d(s,{s:()=>h});var i=t(95155),r=t(12115),a=t(20063),n=t(8525),l=t(83209),d=t(97003),c=t(33789),o=t(90235),m=t(54664),u=t(99510),x=t(28171);function h(e){let{user:s,roomType:t,room:h,services:p,onCancel:g}=e;(0,a.useRouter)();let{toast:j}=(0,x.dj)(),f=(0,n.U)(),[v,b]=(0,r.useState)(""),[N,y]=(0,r.useState)(""),[k,w]=(0,r.useState)(1),[C,S]=(0,r.useState)([]),[_,D]=(0,r.useState)(!1),[B,I]=(0,r.useState)(null),O=()=>{if(!v||!N)return 0;let e=new Date(v),s=Math.ceil((new Date(N).getTime()-e.getTime())/864e5);return s>0?s:0},F=()=>{let e=O();return t.basePrice*e+C.reduce((e,s)=>{let t=p.find(e=>e.id===s);return e+((null==t?void 0:t.price)||0)},0)},P=e=>Array.isArray(e)?e.map(P):null!==e&&"object"==typeof e?Object.keys(e).reduce((s,t)=>(s[t.replace(/[A-Z]/g,e=>"_".concat(e.toLowerCase()))]=P(e[t]),s),{}):e,R=e=>new Date(e).toISOString().split("T")[0],T=async e=>{e.preventDefault();try{var i,r,a;let e={userId:s.id,guestName:(null==s||null==(i=s.user_metadata)?void 0:i.full_name)||(null==(r=s.email)?void 0:r.split("@")[0])||"Guest",guestEmail:s.email||"",guestPhone:(null==s||null==(a=s.user_metadata)?void 0:a.phone)||"Not provided",guestCount:k,roomId:h.id,roomTypeId:t.id,checkInDate:R(v),checkOutDate:R(N),roomPrice:t.basePrice*O(),servicesPrice:C.reduce((e,s)=>{let t=p.find(e=>e.id===s);return e+((null==t?void 0:t.price)||0)},0),totalPrice:F(),status:"confirmed",paymentStatus:"pending",paymentMethod:"credit_card",paidAmount:0,bookingReference:"BK-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9).toUpperCase())},n=P(e);console.log("[Booking] Creating booking with data:",{userId:n.user_id,roomId:n.room_id,checkIn:n.check_in_date,checkOut:n.check_out_date,total:n.total_price,status:n.status,paymentStatus:n.payment_status});let{data:l,error:d}=await f.from("bookings").insert([n]).select().single();if(d||!l)throw console.error("[Booking] Failed to create booking:",d),Error((null==d?void 0:d.message)||"Failed to create booking");let c=l.id;if(console.log("[Booking] Successfully created booking with ID:",c),I(c),C.length>0){let e=C.map(e=>{let s=p.find(s=>s.id===e);return{booking_id:c,service_id:e,quantity:1,unit_price:(null==s?void 0:s.price)||0,total_price:(null==s?void 0:s.price)||0,status:"confirmed"}}),{error:s}=await f.from("booking_services").insert(e);s&&console.error("Error adding services:",s)}D(!0)}catch(e){console.error("[Booking] Failed to create booking:",e),j({title:"Booking failed",description:e.message||"Could not start payment.",variant:"destructive"})}};return _&&B?(0,i.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,i.jsxs)("div",{className:"lg:col-span-2",children:[(0,i.jsx)(u.z,{bookingId:B,amount:Math.round(100*F()),currency:"usd",customerEmail:s.email||void 0}),(0,i.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,i.jsx)(d.$,{variant:"outline",onClick:()=>D(!1),children:"Back"}),g&&(0,i.jsx)(d.$,{variant:"outline",onClick:g,children:"Cancel Booking"})]})]}),(0,i.jsx)("div",{children:(0,i.jsxs)(l.Zp,{className:"glass-card sticky top-24",children:[(0,i.jsx)(l.aR,{children:(0,i.jsx)(l.ZB,{children:"Payment Summary"})}),(0,i.jsxs)(l.Wu,{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold text-lg",children:t.name}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Room ",h.roomNumber]})]}),(0,i.jsx)(m.w,{}),(0,i.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,i.jsx)("span",{children:"Total Amount"}),(0,i.jsxs)("span",{className:"price-badge",children:["$",F()]})]})]})]})})]}):(0,i.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,i.jsx)("div",{className:"lg:col-span-2",children:(0,i.jsxs)(l.Zp,{className:"glass-card border-0",children:[(0,i.jsxs)(l.aR,{children:[(0,i.jsx)(l.ZB,{children:"Complete Your Booking"}),(0,i.jsx)(l.BT,{children:"Fill in the details below to reserve your room"})]}),(0,i.jsx)(l.Wu,{children:(0,i.jsxs)("form",{onSubmit:T,className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.J,{htmlFor:"checkIn",children:"Check-in Date"}),(0,i.jsx)(c.p,{id:"checkIn",type:"date",value:v,onChange:e=>b(e.target.value),min:new Date().toISOString().split("T")[0],required:!0})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.J,{htmlFor:"checkOut",children:"Check-out Date"}),(0,i.jsx)(c.p,{id:"checkOut",type:"date",value:N,onChange:e=>y(e.target.value),min:v||new Date().toISOString().split("T")[0],required:!0})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.J,{htmlFor:"guests",children:"Number of Guests"}),(0,i.jsx)(c.p,{id:"guests",type:"number",value:k,onChange:e=>w(Number.parseInt(e.target.value)),min:1,max:t.maxOccupancy,required:!0}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Maximum ",t.maxOccupancy," guests"]})]}),p.length>0&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(o.J,{children:"Additional Services (Optional)"}),(0,i.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:p.map(e=>(0,i.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors ".concat(C.includes(e.id)?"border-primary bg-primary/5":"border-muted hover:border-primary/50"),onClick:()=>{var s;return s=e.id,void S(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s])},children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{className:"w-4 h-4 rounded border flex items-center justify-center ".concat(C.includes(e.id)?"bg-primary border-primary":"border-muted"),children:C.includes(e.id)&&(0,i.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:["$",e.price]})]})]})},e.id))})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(d.$,{type:"submit",className:"flex-1 glass-button",size:"lg",children:"Continue to Payment"}),g&&(0,i.jsx)(d.$,{type:"button",variant:"outline",onClick:g,children:"Cancel"})]})]})})]})}),(0,i.jsx)("div",{children:(0,i.jsxs)(l.Zp,{className:"glass-card sticky top-24",children:[(0,i.jsx)(l.aR,{children:(0,i.jsx)(l.ZB,{children:"Booking Summary"})}),(0,i.jsxs)(l.Wu,{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold text-lg",children:t.name}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Room ",h.roomNumber]})]}),(0,i.jsx)(m.w,{}),v&&N&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Check-in"}),(0,i.jsx)("span",{className:"font-medium",children:new Date(v).toLocaleDateString()})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Check-out"}),(0,i.jsx)("span",{className:"font-medium",children:new Date(N).toLocaleDateString()})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Nights"}),(0,i.jsx)("span",{className:"font-medium",children:O()})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:"Guests"}),(0,i.jsx)("span",{className:"font-medium",children:k})]})]}),(0,i.jsx)(m.w,{}),(0,i.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsxs)("span",{className:"text-muted-foreground",children:["Room (",O()," nights)"]}),(0,i.jsxs)("span",{className:"font-medium",children:["$",t.basePrice*O()]})]}),C.map(e=>{let s=p.find(s=>s.id===e);return(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-muted-foreground",children:null==s?void 0:s.name}),(0,i.jsxs)("span",{className:"font-medium",children:["$",null==s?void 0:s.price]})]},e)})]}),(0,i.jsx)(m.w,{}),(0,i.jsxs)("div",{className:"flex justify-between text-lg font-semibold",children:[(0,i.jsx)("span",{children:"Total"}),(0,i.jsxs)("span",{className:"price-badge",children:["$",F()]})]})]})]})]})})]})}},90235:(e,s,t)=>{t.d(s,{J:()=>c});var i=t(95155),r=t(12115),a=t(32894),n=t(83101),l=t(25016);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,i.jsx)(a.b,{ref:s,className:(0,l.cn)(d(),t),...r})});c.displayName=a.b.displayName}}]);